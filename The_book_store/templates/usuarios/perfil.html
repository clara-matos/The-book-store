{% extends '_base.html' %}

{% block title %}Meu Perfil{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="h2 fw-bold text-primary">Meu Perfil</h1>
        <p class="text-muted">Gerencie suas informações pessoais e sua lista de livros.</p>
    </div>

    <div class="row g-4">
        <!-- Foto e informações principais -->
        <div class="col-md-4">
            <div class="card h-100 shadow-sm rounded-4 text-center p-4">
                {% if user.foto_perfil %}
                <img src="{{ user.foto_perfil.url }}" class="rounded-circle mb-3" alt="Foto"
                    style="width:120px; height:120px; object-fit:cover;">
                {% else %}
                <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3"
                    style="width:120px; height:120px;">
                    <i class="bi bi-person-fill text-muted" style="font-size:4rem;"></i>
                </div>
                {% endif %}
                <h5 class="fw-bold">{{ user.username }}</h5>
                <p class="text-muted">{{ user.email }}</p>
                <small class="text-secondary">Membro desde: {{ user.date_joined|date:"d/m/Y" }}</small>
                <a href="{% url 'usuarios:editar_perfil' %}" class="btn btn-sm btn-primary mt-3 rounded-pill">
                    <i class="bi bi-pencil-square me-1"></i> Editar
                </a>
            </div>
        </div>

        <!-- Informações pessoais -->
        <div class="col-md-8">
            <div class="card h-100 shadow-sm rounded-4 p-4">
                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-info-circle me-2"></i>Informações</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between"><strong>Usuário</strong> {{ user.username }}</li>
                    <li class="list-group-item d-flex justify-content-between"><strong>Email</strong> {{ user.email }}</li>
                    <li class="list-group-item d-flex justify-content-between"><strong>Biografia</strong> {{ user.usuario.biografia|default:"Não informada" }}</li>
                    <li class="list-group-item d-flex justify-content-between"><strong>Nascimento</strong> {{ user.usuario.data_nascimento|date:"d/m/Y"|default:"Não informada" }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Meus livros -->
    <div class="row g-4 mt-1">
        <div class="col-12">
            <div class="card shadow-sm rounded-4 p-4">
                <h5 class="fw-bold text-primary mb-3"><i class="bi bi-book-half me-2"></i>Meus Livros</h5>
                {% if livros_na_lista %}
                <div class="d-flex flex-wrap gap-2">
                    {% for livro in livros_na_lista %}
                    <a href="{% url 'livros:detalhe_livro' livro.pk %}" class="badge bg-primary p-2 rounded-pill">{{ livro.titulo }}</a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center text-muted">
                    <i class="bi bi-book" style="font-size:2rem;"></i>
                    <p class="mt-2">Nenhum livro adicionado.</p>
                    <a href="{% url 'livros:lista_livros' %}" class="btn btn-sm btn-outline-primary">Explorar livros</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Ações de conta -->
    <div class="d-grid gap-3 mt-4">
        <button type="button" class="btn btn-danger btn-lg rounded-pill" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
            <i class="bi bi-trash me-1"></i> Excluir Perfil
        </button>
    </div>
</div>

<!-- Modal de confirmação de exclusão -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header">
        <h5 class="modal-title text-danger fw-bold" id="confirmDeleteLabel">Confirmar Exclusão</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body text-center">
        <p class="lead">Tem certeza que deseja excluir seu perfil e conta?</p>
        <p class="text-muted">Esta ação é irreversível.</p>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary rounded-pill" data-bs-dismiss="modal">Cancelar</button>
        <form method="post" action="{% url 'usuarios:deletar_perfil' %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger rounded-pill">Confirmar Exclusão</button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
    body {
        background: #f8f9fa;
    }

    .badge:hover {
        transform: translateY(-2px);
        transition: 0.2s;
    }
</style>
{% endblock %}
